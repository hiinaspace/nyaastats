# Nyaastats Website

Observable Framework-based website for visualizing Nyaa torrent download statistics.

## Prerequisites

- Node.js 18+ (for Observable Framework)
- Generated data files from ETL pipeline:
  - `src/data/rankings.json`
  - `src/data/seasons.json`
  - `src/data/season-*.json`
  - `src/data/episodes-*.json`

## Setup

1. **Install dependencies**:
   ```bash
   npm install
   ```

2. **Run ETL pipeline** (from project root):
   ```bash
   cd ..
   uv run nyaastats-etl --db nyaastats.db --output website/src/data
   ```

   This generates the required data files in `src/data/`.

3. **Start development server**:
   ```bash
   npm run dev
   ```

   Open http://localhost:3000 to view the site.

## Development

### File Structure

```
website/
├── src/
│   ├── index.md              # Front page (rankings bump chart)
│   ├── show.md               # Show detail page
│   ├── about.md              # About page
│   └── data/                 # Data files (generated by ETL)
│       ├── rankings.json     # Weekly rankings
│       ├── seasons.json      # Seasons index
│       ├── season-*.json     # Season summaries
│       └── episodes-*.json   # Season episode totals
├── observablehq.config.js    # Framework configuration
└── package.json              # Dependencies
```

### Pages

- **`/`** - Weekly rankings with bump chart
- **`/show?id=<anilist_id>`** - Show detail page with episode charts
- **`/about`** - About page with methodology

### Customization

Edit `observablehq.config.js` to customize:
- Site title and description
- Theme (light/dark)
- Navigation
- Footer

Edit markdown files in `src/` to customize page content and visualizations.

## Building for Production

```bash
npm run build
```

This generates a static site in `dist/` that can be deployed to any static hosting service.

## Deployment

### Option 1: Vercel

1. Install Vercel CLI: `npm i -g vercel`
2. Deploy: `vercel`

### Option 2: Cloudflare Pages

1. Connect your GitHub repository to Cloudflare Pages
2. Set build command: `npm run build`
3. Set output directory: `dist`

### Option 3: GitHub Pages

1. Build: `npm run build`
2. Deploy `dist/` directory to `gh-pages` branch

## Data Updates

To update the visualizations with new data:

1. Run the ETL pipeline (from project root):
   ```bash
   uv run nyaastats-etl --db nyaastats.db --output website/src/data
   ```

2. Rebuild the site:
   ```bash
   npm run build
   ```

3. Deploy the updated `dist/` directory

For automated updates, set up a cron job or GitHub Action to run the ETL weekly and trigger a redeploy.

## Troubleshooting

### Data files not found

Ensure the ETL pipeline has been run and generated files exist in `src/data/`:
- `src/data/rankings.json`
- `src/data/seasons.json`
- `src/data/season-*.json`
- `src/data/episodes-*.json`

### Observable Framework errors

Check that you're using Node.js 18 or higher:
```bash
node --version
```

### Missing dependencies

Reinstall dependencies:
```bash
rm -rf node_modules package-lock.json
npm install
```

## Learn More

- [Observable Framework Documentation](https://observablehq.com/framework/)
- [Observable Plot Documentation](https://observablehq.com/plot/)
- [Arquero API Reference](https://uwdata.github.io/arquero/)

## License

WTFPL
